{% extends "base.html" %}

{% block title %}–ú–æ–∏ –æ—Ü–µ–Ω–∫–∏ - TeamManager{% endblock %}

{% block content %}
<div class="page-header">
    <h1>üìä –ú–æ–∏ –æ—Ü–µ–Ω–∫–∏</h1>
</div>

<!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-label">–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</div>
        <div class="stat-value">{{ "%.2f"|format(statistics.average) }}</div>
        <div class="stat-description">
            {% if statistics.average >= 4.5 %}
            –û—Ç–ª–∏—á–Ω–æ! ‚≠ê
            {% elif statistics.average >= 3.5 %}
            –•–æ—Ä–æ—à–æ üëç
            {% elif statistics.average >= 2.5 %}
            –£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ
            {% else %}
            –¢—Ä–µ–±—É–µ—Ç—Å—è —É–ª—É—á—à–µ–Ω–∏–µ
            {% endif %}
        </div>
    </div>

    <div class="stat-card">
        <div class="stat-label">–í—Å–µ–≥–æ –æ—Ü–µ–Ω–æ–∫</div>
        <div class="stat-value">{{ statistics.total }}</div>
        <div class="stat-description">–∑–∞–¥–∞—á –æ—Ü–µ–Ω–µ–Ω–æ</div>
    </div>

    <div class="stat-card">
        <div class="stat-label">–ú–∏–Ω / –ú–∞–∫—Å</div>
        <div class="stat-value">{{ statistics.min }} / {{ statistics.max }}</div>
        <div class="stat-description">–¥–∏–∞–ø–∞–∑–æ–Ω –æ—Ü–µ–Ω–æ–∫</div>
    </div>
</div>

<!-- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫ -->
{% if statistics.total > 0 %}
<div class="section">
    <h2>–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫</h2>
    <div class="score-distribution">
        {% for score in [5, 4, 3, 2, 1] %}
        <div class="score-bar-container">
            <div class="score-label">
                <span class="score-number">{{ score }}</span>
                <span class="score-name">
                    {% if score == 5 %}–û—Ç–ª–∏—á–Ω–æ{% endif %}
                    {% if score == 4 %}–û—á–µ–Ω—å —Ö–æ—Ä–æ—à–æ{% endif %}
                    {% if score == 3 %}–•–æ—Ä–æ—à–æ{% endif %}
                    {% if score == 2 %}–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ{% endif %}
                    {% if score == 1 %}–ù–µ—É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ{% endif %}
                </span>
            </div>
            <div class="score-bar-wrapper">
                {% set count = statistics.by_score[score] %}
                {% set percentage = (count / statistics.total * 100)|int %}
                <div class="score-bar score-{{ score }}" style="width: {{ percentage }}%"></div>
                <span class="score-count">{{ count }} ({{ percentage }}%)</span>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

<!-- –°–ø–∏—Å–æ–∫ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –æ—Ü–µ–Ω–æ–∫ -->
<div class="section">
    <h2>–ü–æ—Å–ª–µ–¥–Ω–∏–µ 20 –æ—Ü–µ–Ω–æ–∫</h2>

    {% if evaluations %}
    <div class="evaluations-table">
        <table>
            <thead>
                <tr>
                    <th>–î–∞—Ç–∞</th>
                    <th>–ó–∞–¥–∞—á–∞</th>
                    <th>–û—Ü–µ–Ω–∫–∞</th>
                    <th>–û—Ü–µ–Ω—â–∏–∫</th>
                    <th>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th>
                </tr>
            </thead>
            <tbody>
                {% for evaluation in evaluations %}
                <tr>
                    <td>{{ evaluation.created_at.strftime('%d.%m.%Y %H:%M') }}</td>
                    <td>
                        <a href="/tasks/{{ evaluation.task_id }}">{{ evaluation.task.title if evaluation.task else '–ó–∞–¥–∞—á–∞ #' ~ evaluation.task_id }}</a>
                    </td>
                    <td>
                        <span class="badge badge-score-{{ evaluation.score }}">
                            {{ evaluation.score }} - {{ evaluation.score_description }}
                        </span>
                    </td>
                    <td>
                        {% if evaluation.evaluator %}
                        {{ evaluation.evaluator.first_name }} {{ evaluation.evaluator.last_name }}
                        {% else %}
                        -
                        {% endif %}
                    </td>
                    <td>
                        {% if evaluation.comment %}
                        <span class="evaluation-comment">{{ evaluation.comment[:100] }}{% if evaluation.comment|length > 100 %}...{% endif %}</span>
                        {% else %}
                        <span class="text-muted">-</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="empty-state">
        <p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –æ—Ü–µ–Ω–æ–∫</p>
        <p class="text-muted">–û—Ü–µ–Ω–∫–∏ –ø–æ—è–≤—è—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–¥–∞—á</p>
    </div>
    {% endif %}
</div>

<style>
/* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.stat-card {
    background: #f8f9fa;
    padding: 20px;
    border-radius: 8px;
    text-align: center;
    border: 1px solid #e0e0e0;
}

.stat-label {
    font-size: 14px;
    color: #666;
    margin-bottom: 10px;
}

.stat-value {
    font-size: 36px;
    font-weight: bold;
    color: #333;
    margin-bottom: 5px;
}

.stat-description {
    font-size: 13px;
    color: #888;
}

/* –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫ */
.section {
    background: white;
    padding: 25px;
    border-radius: 8px;
    margin-bottom: 30px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.section h2 {
    font-size: 20px;
    margin-bottom: 20px;
    color: #333;
}

.score-distribution {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.score-bar-container {
    display: flex;
    align-items: center;
    gap: 15px;
}

.score-label {
    min-width: 180px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.score-number {
    font-size: 20px;
    font-weight: bold;
    color: #333;
    min-width: 25px;
}

.score-name {
    font-size: 14px;
    color: #666;
}

.score-bar-wrapper {
    flex: 1;
    display: flex;
    align-items: center;
    gap: 10px;
}

.score-bar {
    height: 30px;
    border-radius: 4px;
    transition: width 0.3s ease;
    min-width: 2px;
}

.score-5 { background: #28a745; }
.score-4 { background: #20c997; }
.score-3 { background: #ffc107; }
.score-2 { background: #fd7e14; }
.score-1 { background: #dc3545; }

.score-count {
    font-size: 13px;
    color: #666;
    min-width: 80px;
}

/* –¢–∞–±–ª–∏—Ü–∞ –æ—Ü–µ–Ω–æ–∫ */
.evaluations-table {
    overflow-x: auto;
}

.evaluations-table table {
    width: 100%;
    border-collapse: collapse;
}

.evaluations-table th {
    background: #f8f9fa;
    padding: 12px;
    text-align: left;
    font-weight: 600;
    color: #333;
    border-bottom: 2px solid #dee2e6;
}

.evaluations-table td {
    padding: 12px;
    border-bottom: 1px solid #e9ecef;
    vertical-align: top;
}

.evaluations-table tr:hover {
    background: #f8f9fa;
}

.badge-score-5 { background: #28a745; color: white; }
.badge-score-4 { background: #20c997; color: white; }
.badge-score-3 { background: #ffc107; color: #333; }
.badge-score-2 { background: #fd7e14; color: white; }
.badge-score-1 { background: #dc3545; color: white; }

.evaluation-comment {
    font-size: 14px;
    color: #555;
    font-style: italic;
}

.empty-state {
    text-align: center;
    padding: 60px 20px;
    color: #666;
}

.empty-state p {
    margin: 10px 0;
}

.text-muted {
    color: #999;
}
</style>
{% endblock %}
